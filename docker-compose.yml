# TraderMind Docker Compose
# Development environment configuration
# NOTE: AI layer is optional and not included in this compose file

version: "3.9"

services:
  # ==========================================================================
  # FRONTEND
  # ==========================================================================
  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
    ports:
      - "5173:80"
    environment:
      - VITE_SUPABASE_URL=${SUPABASE_URL}
      - VITE_SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - VITE_API_GATEWAY_URL=http://localhost:3000
    depends_on:
      - api-gateway
    networks:
      - tradermind

  # ==========================================================================
  # API GATEWAY
  # ==========================================================================
  api-gateway:
    build:
      context: .
      dockerfile: Dockerfile.api-gateway
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - REDIS_URL=redis://redis:6379
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_ANON_KEY=${SUPABASE_ANON_KEY}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - SESSION_SECRET=${SESSION_SECRET}
      - DERIV_TOKEN_KEY=${DERIV_TOKEN_KEY}
      - DERIV_APP_ID=${DERIV_APP_ID}
      - CORS_ORIGIN=${CORS_ORIGIN:-http://localhost:5173}
      - FRONTEND_URL=http://localhost:5173
    depends_on:
      - redis
    networks:
      - tradermind

  # ==========================================================================
  # QUANT ENGINE - Pure Quantitative Trading
  # 10 Trading Strategies | Database Learning | Jump & Volatility Indices
  # ==========================================================================
  quant-engine:
    build:
      context: .
      dockerfile: Dockerfile.quant-engine
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - REDIS_URL=redis://redis:6379
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - DERIV_APP_ID=${DERIV_APP_ID}
      - DERIV_TOKEN_KEY=${DERIV_TOKEN_KEY}
    depends_on:
      - redis
    networks:
      - tradermind

  # ==========================================================================
  # INFRASTRUCTURE
  # ==========================================================================
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes
    networks:
      - tradermind

networks:
  tradermind:
    driver: bridge

volumes:
  redis_data:
